let App4Sea=function(){"use strict";let e={prefProj:"EPSG:4326",prefViewProj:"EPSG:3857"};return e.mapCenter=ol.proj.transform([-3,65],e.prefProj,e.prefViewProj),e.mapExtent=ol.proj.transformExtent([-180,-90,180,90],e.prefProj,e.prefViewProj),e.minZoom=2,e.maxZoom=18,e.startZoom=4,e.logging=5,e.useIconsInMenu=!0,e.disableSubItems=!1,e.Animation={},e.KML={},e.Measure={},e.OpenLayers={},e.PopUps={},e.TreeInfo={},e.TreeMenu={},e.Utils={},e.Weather={},e.logging&&console.log("Map extent "+[-180,90,180,-90]),e.logging&&console.log("Map extent "+e.mapExtent),e.logging&&console.log("Windows width is "+window.innerWidth),e}();App4SeaAnimation=function(){"use strict";function e(){let e=document.getElementById("start");e.innerHTML=m.substr(m.length-8,8),e=document.getElementById("current"),e.innerHTML=y.substr(y.length-8,8),e=document.getElementById("end"),e.innerHTML=u.substr(u.length-8,8),e=document.getElementById("startDate"),e.innerHTML=m.substr(0,10),e=document.getElementById("currentDate"),e.innerHTML=y.substr(0,10),e=document.getElementById("endDate"),e.innerHTML=u.substr(0,10)}function t(){let e=document.getElementById("current");if("undefined"===e)return;e.innerHTML=y.substr(y.length-8,8),e=document.getElementById("currentDate"),e.innerHTML=y.substr(0,10);let t=a.AniData[d][A],o=(n(t),1);App4Sea.TreeMenu.Checkbox(t,!0);let r=A-o;for(;r<0;)r+=g;t=a.AniData[d][r],App4Sea.TreeMenu.Checkbox(t,!1),w.value=100*A/g,A+=1,A===g&&(A=0)}function n(e){for(let t=0;t<App4Sea.OpenLayers.layers.length;t++){let n=App4Sea.OpenLayers.layers[t];if(n.id===e)return t}return-1}function o(){return"Playing"!==f?(l(),void(f="Stopped")):null===h||null===a.AniData[i]?(l(),void(f="Stopped")):(y=0!==a.AniData[s].length?a.AniData[s][A].innerHTML:a.AniData[p][A].innerHTML,void t())}let a={Animate:function(e,t){"Stopped"!==f&&l(),f="Stopped";let n=e.substr(e.length-3,3);if("kml"!==n&&"kmz"!==n)return;g=a.AniData[i].length;let o=document.getElementById("AniDataSelect");for(let e=0;e<o.length;e++)"No data available"==o.options[e].text&&o.remove(e);let r=document.createElement("option");r.innerHTML=t,o.appendChild(r),o.value=t},getAnimationState:function(){return f},MoreSpeed:function(){S<30.01&&(S+=1,null!==h&&(window.clearInterval(h),h=window.setInterval(o,1e3/S)))},LessSpeed:function(){S>1.99&&(S-=1,null!==h&&(window.clearInterval(h),h=window.setInterval(o,1e3/S)))},PlayStop:function(){if("Stopped"!==f&&"Playing"!==f)return;f="Transition";let e=v.classList.contains("fa-play");e?(l(),r(),v.classList.remove("fa-play"),v.classList.add("fa-stop"),h=window.setInterval(o,1e3/S),f="Playing"):(l(),f="Stopped")}},r=function(){if(0!==g){for(let e=0;e<g;e++)App4Sea.TreeMenu.Checkbox(a.AniData[d][e],!1);0!==a.AniData[s].length?(m=a.AniData[s][0].innerHTML,u=a.AniData[s][a.AniData[1].length-1].innerHTML):(m=a.AniData[p][0].innerHTML,u=a.AniData[c][a.AniData[c].length-1].innerHTML),y=m,e()}},l=function(){f="Stopping",null!==h&&(window.clearInterval(h),h=null),v.classList.remove("fa-stop"),v.classList.add("fa-play")};a.Progress=function(){void 0!==g&&(A=parseInt(.5+w.value*g/100),l(),f="Stopped",r(),t())},a.AniData=[[],[],[],[],[]];const i=0,s=1,p=2,c=3,d=4;let g,u,m,y,f="Stopped",S=1,h=null,A=0;const v=document.getElementById("playstop"),w=document.getElementById("progress");return w.addEventListener("input",a.Progress,!1,{passive:!0}),w.addEventListener("touch",a.Progress,!1,{passive:!0}),a}(),App4Sea.Animation=App4SeaAnimation,$(document).ready(function(){"use strict";App4Sea.logging&&console.log("Document ready"),App4Sea.logging&&console.log(App4Sea.OpenLayers),App4Sea.OpenLayers.Init(),$(".MenuItem").click(function(){App4Sea.logging&&console.log("MenuItem click");var e=$(this).attr("data-url"),t=$(this).attr("data-target");window.open(e,t)})}),$(window).on("load",function(){"use strict";App4Sea.logging&&console.log("Window load"),setTimeout(function(){App4Sea.logging&&console.log("setTimeout"),$("#splash-overlay").fadeOut()},2e3);var e=$("#ToolTipInfo");e.tooltip("hide"),e.tooltip({animation:!1,trigger:"manual"})}),$(window).on("resize",function(){"use strict";const e=document.getElementById("ControlPlaceInMap");window.innerWidth<500?(e.style.left=0,e.transform=null):(e.style.left=null,e.transform="translate(-50%, 0%)");let t=e.clientWidth/2+.5;e.offsetLeft-t>window.innerWidth-40&&(e.style.left=window.innerWidth-40+t+"px")}),App4SeaKML=function(){"use strict";function e(e,o){var a=e.toLowerCase();App4Sea.logging&&console.log(a),a.endsWith("kmz")?(App4Sea.logging&&console.log("readAndAddFeatures kmz element: "+e),t(e,o,n(g,o))):(App4Sea.logging&&console.log("readAndAddFeatures non-kmz element: "+e),t(e,o,g))}function t(e,t,n){App4Sea.logging&&console.log("ajaxKMZ: "+e);let o=function(e,n){return function(o,a){App4Sea.logging&&console.log("ajaxKMZ OK: "+o.responseURL);let r=o.responseURL.toLowerCase(),l=typeof a;if(!r.endsWith("kml")||"object"!==l&&"string"!==l)App4Sea.logging&&console.log("Now handling "+r),n(a,r,t);else{let t=function(e,t,n){return function(o){App4Sea.logging&&console.log("Callback: "+t+": "+e);let a=o.srcElement.result;App4Sea.logging&&console.log(a),n(a,e,t)}},o=new FileReader;o.addEventListener("loadend",t(r,e,n),!1,{passive:!0}),"string"===l?n(a,r,e):o.readAsBinaryString(a)}}},a="multipart/form-data";e.toLowerCase().endsWith("kmz")?a="blob":e.toLowerCase().endsWith("kml")&&(a="text"),qwest.get(e,null,{responseType:a,cache:!0,headers:{}}).then(o(t,n)).catch(function(e,n){App4Sea.logging&&console.log("ajaxKMZ Error: "+e+": Url: "+n.responseURL+", id: "+t)}).complete(function(){})}function n(e,t){return function(n){App4Sea.logging&&console.log("Unzip id "+t),zip.createReader(new zip.BlobReader(n),function(n){n.getEntries(function(n){App4Sea.logging&&console.log("Got entries: "+n.length);for(let o=0;o<n.length;o++){let a=function(e,t,n,o){return function(a){n(a,e,t,o)}},r=n[o].filename.toLowerCase();r.endsWith(".kml")&&(App4Sea.logging&&console.log("Entry "+o+": "+r),n[o].getData(new zip.TextWriter,a(r,t,e,n),function(e,t){}))}})},function(e){App4Sea.logging&&console.log("unzipFromBlob Error: "+e)})}}function o(e,t,n){App4Sea.logging&&console.log(">>> addKMLFeatures: "+t),t.endsWith("kml")&&(a(e,n,t),App4Sea.logging&&console.log("addKMLFeatures: "+n+" in file "+t+" DONE")),App4Sea.logging&&console.log("<<< addKMLFeatures")}function a(e,t,n){App4Sea.logging&&console.log("loadKmlText: "+n);let o=new ol.format.KML({extractStyles:!0,extractAttributes:!0,showPointNames:!1}),a=o.readProjection(e);null!==a&&App4Sea.logging&&console.log("Projection: "+a.getCode());let r=o.readFeatures(e,{dataProjection:a.getCode(),featureProjection:App4Sea.prefViewProj});App4Sea.logging&&console.log("kml_features are: "+r.length),r.length;let l=new ol.layer.Vector({source:new ol.source.Vector({crossOrigin:"anonymous",format:o})}),i=l.getSource();i.addFeatures(r);let s=App4Sea.Utils.GetFeaturesExtent(r),p=null;if(void 0!==s){let e=i.getProjection(),t=App4Sea.Utils.TransformExtent(s,App4Sea.prefViewProj,App4Sea.prefProj),n=t[0]+t[2],o=t[1]+t[3];p=[n/2,o/2],App4Sea.logging&&console.log("Extent: "+s+", proj: "+e+", ext: "+t)}App4Sea.OpenLayers.layers.push({id:t,vector:l}),App4Sea.logging&&console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(l),App4Sea.Utils.FlyTo(p,null)}function r(e,t,n){return{type:n.nodeName,id:n.id,newId:e,parentId:t,node:n,value:n.innerHTML}}function l(e,t){var n,o=e+"-"+t.id;switch(t.nodeName){case"StyleMap":n=r(o,e,t),App4Sea.OpenLayers.styleMaps.push(n);break;case"Style":n=r(o,e,t),App4Sea.OpenLayers.styleMaps.push(n),o=App4Sea.OpenLayers.styleMaps.length}return o}function i(e,t,n,o,a,r){let l=a;App4Sea.disableSubItems||(l=!1);let i={state:{closed:!0,checkbox_disabled:!1,disabled:l},icon:r,text:e,data:t,selected:!0,children:!1},s=n.jstree(!0).create_node(o,i,"last",!1,!1);return s}function s(e,t,n,o){function a(e,t){for(var n=0;n<e.length;n++)if("name"===e[n].nodeName||"atom:name"===e[n].nodeName)return e[n].innerHTML;return t}function r(e,t){var n=document.createElement("tr");n.name=e,n.innerHTML='<td><img class="imgLegend" src="'+t+'" alt="Legend"/></td>                <td><button class="btn-right" title="Close" onclick="App4Sea.KML.removeRow(this)"><i class="fa fa-close"></i></button></td>';const o=document.getElementById("tableLegend");o.appendChild(n)}function s(e,t){function n(e,t,n,o,a,l,i){let s=function(e,t,n,o,a,l,i){return function(e){let a=URL.createObjectURL(e);if(i)r(p,a);else{let e=new ol.source.ImageStatic({url:a,imageExtent:t,projection:n}),r=new ol.layer.Image({name:o,source:e});r?(App4Sea.logging&&console.log("Pushing image to: "+t),App4Sea.OpenLayers.layers.push({id:l,vector:r}),App4Sea.OpenLayers.Map.addLayer(r),App4Sea.Utils.LookAt(r)):App4Sea.logging&&console.log("No image created from kmz")}}};e.getData(new zip.BlobWriter("text/plain"),s(t,n,o,a,e,l,i))}function a(e,t,o,a,r,l,i){let s=!1;for(let p=0;p<e.length;p++)e[p].filename===t&&(n(e[p],t,o,a,r,l,i),s=!0);s||App4Sea.logging&&console.log("Didn't find file in kmz: "+t)}let l,i=e.querySelector("Icon href"),s="";const p=e.querySelector("name");if(p&&(s=p.innerHTML),i&&(l=i.innerHTML),"ScreenOverlay"===e.nodeName)App4Sea.logging&&console.log("ScreenOverlay: "+l),l&&(!l.startsWith("http")&&o&&o.length>1?(App4Sea.logging&&console.log("Getting legend from kmz: "+l),a(o,l,null,null,s,t,!0)):r(p,l));else{if("PhotoOverlay"===e.nodeName)return void(App4Sea.logging&&console.log("PhotoOverlay: "+l));{App4Sea.logging&&console.log("GroundOverlay: "+l),l=l.replaceAll(/&amp;/,"&");const n=parseFloat(e.querySelector("west").innerHTML),r=parseFloat(e.querySelector("south").innerHTML),i=parseFloat(e.querySelector("east").innerHTML),p=parseFloat(e.querySelector("north").innerHTML);let d,g=ol.proj.transformExtent([n,r,i,p],App4Sea.prefProj,App4Sea.prefViewProj);if(App4Sea.logging&&console.log("GroundOverlay: W:"+n+" S:"+r+" E:"+i+" N:"+p+" Pro:"+App4Sea.prefProj+" ViewProj:"+App4Sea.prefViewProj),c+=1,!l.startsWith("http")&&o&&o.length>1)App4Sea.logging&&console.log("Getting image from kmz: "+l),a(o,l,g,App4Sea.prefViewProj,s,t);else{App4Sea.logging&&console.log("Getting image from url: "+l);let e=new ol.source.ImageStatic({url:l,crossOrigin:"anonymous",imageExtent:g,projection:App4Sea.prefViewProj});d=new ol.layer.Image({name:s,source:e}),d&&(App4Sea.OpenLayers.layers.push({id:t,vector:d}),App4Sea.logging&&console.log("Added image from url. Cached layers now are "+App4Sea.OpenLayers.layers.length+": "+l),App4Sea.OpenLayers.Map.addLayer(d),App4Sea.Utils.LookAt(d))}}}}function g(e,t){for(var n=0;n<t.length;n++){var o,r=t[n];if("name"===r.nodeName||"atom:name"===r.nodeName)App4Sea.logging&&console.log("Name item not handled: "+r.innerHTML);else if("description"===r.nodeName){let t=r;if(""!==t.innerHTML){let n=App4Sea.Utils.NoXML(t.innerHTML);o=i("Description",n,$("#TreeMenu"),e,!1,"icons/description.png")}}else if("author"===r.nodeName||"atom:author"===r.nodeName){let t=r,n="<p>";for(let e=0;e<t.children.length;e++){0!==e&&(n+="<br/>");let o=App4Sea.Utils.NoXML(t.children[e].innerHTML);n+=o}n+="</p>",o=i("Author",n,$("#TreeMenu"),e,!1,"icons/author.png")}else if("Folder"===r.nodeName||"Document"===r.nodeName)o=i(a(r.children,r.nodeName),r.innerHTML,$("#TreeMenu"),e,!0,"icons/folder.png");else if("Camera"===r.nodeName){let e;e=r.getElementsByTagName("longitude");let t=parseFloat(e[0].textContent);e=r.getElementsByTagName("latitude");let n=parseFloat(e[0].textContent);e=r.getElementsByTagName("altitude");let o=parseFloat(e[0].textContent),a=App4Sea.Utils.altitudeToZoom(o);App4Sea.Utils.FlyTo([t,n],null),App4Sea.logging&&console.log("Camera set to lon="+t+" lat="+n+" alt="+o+"m zoom="+a)}else if("Placemark"===r.nodeName)o=i(a(r.children,r.nodeName),r.innerHTML,$("#TreeMenu"),e,!0,"icons/placemark.png");else if("GroundOverlay"===r.nodeName||"PhotoOverlay"===r.nodeName||"ScreenOverlay"===r.nodeName){o=i(a(r.children,r.nodeName),r.innerHTML,$("#TreeMenu"),e,!1,"icons/overlay.png"),s(r,o);for(var p="",c=0;c<r.children.length;c++){var d=r.children[c].localName;if(d=d.substr(0,4),"Icon"===d&&r.children[c].children&&r.children[c].children.length>0){p=r.children[c].children[0].innerHTML;break}}"GroundOverlay"===r.nodeName&&p===h[M].innerHTML&&(L[M]=o,M+=1)}else"StyleMap"===r.nodeName||"Style"===r.nodeName?o=l(e,r):"TimeSpan"===r.nodeName||"TimeStamp"===r.nodeName||"Link"===r.nodeName||"atom:link"===r.nodeName||"NetworkLink"===r.nodeName||"open"===r.nodeName||"href"===r.nodeName||"visibility"===r.nodeName||"refreshMode"===r.nodeName||"refreshInterval"===r.nodeName||"ExtendedData"===r.nodeName||"Icon"===r.nodeName||"LatLonBox"===r.nodeName||"MultiGeometry"===r.nodeName||"gx:Tour"===r.nodeName||"gx:Playlist"===r.nodeName||"Schema"===r.nodeName||"SimpleField"===r.nodeName||"LineString"===r.nodeName||"Point"===r.nodeName||"Snippet"===r.nodeName||"Region"===r.nodeName||"longitude"===r.nodeName||"latitude"===r.nodeName||"altitude"===r.nodeName||"tilt"===r.nodeName||"altitudeMode"===r.nodeName||"roll"===r.nodeName||"gx:altitudeMode"===r.nodeName||"key"===r.nodeName||"styleUrl"===r.nodeName||"Pair"===r.nodeName||"BalloonStyle"===r.nodeName||"text"===r.nodeName||"LabelStyle"===r.nodeName||"PolyStyle"===r.nodeName||"LineStyle"===r.nodeName||"ListStyle"===r.nodeName||"gx:IconStackStyle"===r.nodeName||"IconStyle"===r.nodeName||""!==r.innerHTML&&App4Sea.logging&&console.log("Not handling "+r.nodeName+" with "+r.innerHTML);if(r.children&&r.children.length>0){for(var u=[],m=r.parentNode;m;)u.push(m),m=m.parentNode;u&&u.length<4&&g(o,r.children)}}}App4Sea.logging&&console.log("parseKmlText: "+e);var u=new DOMParser,m=u.parseFromString(t,"text/xml"),y=m.querySelectorAll("NetworkLink > Link > href"),f=m.querySelectorAll("NetworkLink > Url > href"),S=!1,h=m.querySelectorAll("GroundOverlay > Icon > href"),A=[],v=[],w=[],L=[],M=0;h.length>1?(S=!0,A=m.querySelectorAll("GroundOverlay > TimeStamp > when"),0===A.length?(v=m.querySelectorAll("GroundOverlay > TimeSpan > begin"),w=m.querySelectorAll("GroundOverlay > TimeSpan > end"),A=[]):(v=[],w=[]),App4Sea.Animation.AniData=[h,A,v,w,L]):App4Sea.Animation.AniData=[null,null,null,null,null];var b=m.querySelector("kml");p.removeRow=function(e){document.getElementById("tableLegend").removeChild(e.parentNode.parentNode)},b&&(g(n,b.children),S&&App4Sea.Animation.Animate(e,d));var I=Array.prototype.slice.call(y).map(function(e){return e.textContent});return 0===y.length&&0!==f.length&&(I=Array.prototype.slice.call(f).map(function(e){return e.textContent})),App4Sea.logging&&console.log("NetworkLink files: "+I.length),I}var p={};let c=0;var d="";zip.workerScriptsPath="static/js/",p.loadKml=function(e){App4Sea.logging&&console.log("loadKml: "+e);var t=new ol.layer.Vector({source:new ol.source.Vector({url:e,crossOrigin:"anonymous",format:new ol.format.KML({extractStyles:!0,extractAttributes:!0,showPointNames:!1})})});return t},p.loadKmlKmz=function(t,n,o){App4Sea.logging&&console.log("loadKmz: "+n+" from "+t),d=o,e(t,n)};let g=function(t,n,a,r){App4Sea.logging&&console.log("readAndAddFeatures >>>> "+n+" from file "+a);let l=n.toLowerCase();if(l.endsWith("kml")){o(t,l,a);let i=s(n,t,a,r);App4Sea.logging&&console.log("listFilesNested are "+i.length),i.forEach(function(t){App4Sea.logging&&console.log("readAndAddFeatures ----------"),e(t,a)})}App4Sea.logging&&console.log("readAndAddFeatures <<<<")};return p}(),App4SeaMeasure=function(){"use strict";function e(e){let o;S=e,a=new ol.interaction.Draw({source:r,type:S,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 55, 55, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 55, 55, 0.2)"})})})}),App4Sea.OpenLayers.Map.addInteraction(a),n(),t(),a.on("drawstart",function(e){i=e.feature;let t=e.coordinate;o=i.getGeometry().on("change",function(e){let n,o=e.target;o instanceof ol.geom.Polygon?(n=v(o),t=o.getInteriorPoint().getCoordinates()):o instanceof ol.geom.LineString&&(n=A(o),t=o.getLastCoordinate()),c.innerHTML=n,d.setPosition(t)})},this),a.on("drawend",function(){c.className="tooltip tooltip-static",d.setOffset([0,-7]),i=null,c=null,n(),ol.Observable.unByKey(o)},this)}function t(){s&&s.parentNode&&s.parentNode.removeChild(s),s=document.createElement("div"),s.className="tooltip hidden",p=new ol.Overlay({element:s,offset:[15,0],positioning:"center-left"}),App4Sea.OpenLayers.Map.addOverlay(p)}function n(){c&&c.parentNode&&c.parentNode.removeChild(c),c=document.createElement("div"),c.className="tooltip tooltip-measure",d=new ol.Overlay({element:c,offset:[0,-30],positioning:"bottom-center"}),App4Sea.OpenLayers.Map.addOverlay(d)}function o(e){let t=document.getElementsByClassName(e);if(t)for(;t.length;)t[0]&&t[0].parentNode&&t[0].parentNode.removeChild(t[0])}let a,r,l,i,s,p,c,d,g={},u=[];const m="Click to continue drawing\nthe polygon to measure area",y="Click to continue drawing\nthe line to measure length";let f,S="NotActive",h=function(e){if("NotActive"===S||e.dragging)return;let t="Click to start measuring";if(i){let e=i.getGeometry();e instanceof ol.geom.Polygon?t=m:e instanceof ol.geom.LineString&&(t=y)}s.innerHTML=t,p.setPosition(e.coordinate),s.classList.remove("hidden")},A=function(e){let t,n=ol.sphere.getLength(e);return t=n>100?Math.round(n/1e3*100)/100+" km":Math.round(100*n)/100+" m",t},v=function(e){let t,n=ol.sphere.getArea(e);return t=n>1e4?Math.round(n/1e6*100)/100+" km<sup>2</sup>":Math.round(100*n)/100+" m<sup>2</sup>",t};g.DoLength=function(){b(),M("LineString");const e=document.getElementById("btnArea"),t=document.getElementById("btnLength");e.style.borderStyle="none",t.style.borderStyle="inset"},g.DoArea=function(){b(),M("Polygon");const e=document.getElementById("btnArea"),t=document.getElementById("btnLength");e.style.borderStyle="inset",t.style.borderStyle="none"},g.DoClearAll=function(){b(),s&&s.parentNode&&s.parentNode.removeChild(s),c&&c.parentNode&&c.parentNode.removeChild(c),u.forEach(e=>{App4Sea.OpenLayers.Map.removeLayer(e)}),u=[],o("tooltip tooltip-measure"),o("tooltip tooltip-static"),w();const e=document.getElementById("btnArea"),t=document.getElementById("btnLength");e.style.borderStyle="none",t.style.borderStyle="none"},g.DoAcceptDragAndDrop=function(){f=new ol.interaction.DragAndDrop({formatConstructors:[ol.format.GPX,ol.format.GeoJSON,ol.format.IGC,ol.format.KML,ol.format.TopoJSON]}),f.on("addfeatures",function(e){let t=new ol.source.Vector({features:e.features}),n=new ol.layer.Vector({source:t});u.push(n),App4Sea.OpenLayers.Map.addLayer(n),App4Sea.Utils.LookAt(t)}),App4Sea.OpenLayers.Map.addInteraction(f)},g.DoSaveAll=function(){if(!r)return;let e=r.getFeatures(),t="App4Sea_"+Date.now().toString()+".kml",n=App4Sea.Utils.GetKMLFromFeatures(e,t);App4Sea.Utils.DoSaveKML(n,t)},g.DoNothing=function(e){g.DoClearAll(),App4Sea.Utils.w3_close(e)};let w=function(){App4Sea.OpenLayers.Map.removeLayer(l),l=null,r=null},L=function(){App4Sea.OpenLayers.Map.removeLayer(l),r=new ol.source.Vector,l=new ol.layer.Vector({source:r,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 55, 55, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}),App4Sea.OpenLayers.Map.addLayer(l)},M=function(t){l||L(),e(t),App4Sea.OpenLayers.Map.on("pointermove",h),App4Sea.OpenLayers.Map.getViewport().addEventListener("mouseout",function(){s.classList.add("hidden")},!1,{passive:!0})},b=function(){S="NotActive",App4Sea.OpenLayers.Map.removeInteraction(a)};return g.GetType=function(){return S},g.DropMarker=function(){let e=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([0,50]))}),t=new ol.source.Vector({features:[e]}),n=new ol.layer.Vector({source:t});App4Sea.OpenLayers.Map.addLayer(n)},g}(),App4Sea.Measure=App4SeaMeasure,App4SeaOpenLayers=function(){"use strict";function e(){g.descriptionContainer=document.getElementById("InfoPopup"),s=new ol.layer.Tile({name:"osmTileLayer",crossOriginKeyword:"anonymous",source:new ol.source.OSM}),p=new ol.layer.Tile({name:"esriWSPTileLayer",crossOriginKeyword:"anonymous",source:new ol.source.XYZ({attributions:['&copy; <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/0">ArcGIS World Street Map</a>'],url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"})}),c=new ol.layer.Tile({name:"esriWITileLayer",crossOriginKeyword:"anonymous",source:new ol.source.XYZ({attributions:['&copy; <a href="https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/0">ArcGIS World Imagery Map</a>'],url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),d=new ol.layer.Tile({name:"blackTileLayer",crossOriginKeyword:"anonymous",source:new ol.source.XYZ({attributions:['&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'],url:"http://{a-c}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png"})})}function t(){let e=new ol.Map({target:"MapContainer",view:new ol.View({center:App4Sea.mapCenter,zoom:App4Sea.startZoom,minZoom:App4Sea.minZoom,maxZoom:App4Sea.maxZoom})});g.Map=e,g.Map.on("singleclick",function(e){App4Sea.PopUps.SingleClick(e)}),g.Map.on("not_working",function(e){App4Sea.Weather.NotWorking(e)})}function n(){let e=$("#MenuLayer_Select").val();if(e!==i.name){g.Map.removeLayer(i);let t=$("#MenuContainer"),n=$("#ButtonsForMenu"),o=$("#ButtonsForTools"),a=$("#ButtonsForSettings"),r=$("#ButtonsForToolsInMap"),l=document.getElementsByClassName("ol-mouse-position");"osmTileLayer"===e?(t[0].style.backgroundImage="var(--gradientWhite)",t[0].style.color="black",n[0].style.filter="invert(0%)",o[0].style.filter="invert(0%)",a[0].style.filter="invert(0%)",r[0].style.filter="invert(0%)",l&&l.length>0&&(l[0].style.color="black"),i=s):"esriWSPTileLayer"===e?(t[0].style.backgroundImage="var(--gradientBeige)",t[0].style.color="black",n[0].style.filter="invert(0%)",o[0].style.filter="invert(0%)",a[0].style.filter="invert(0%)",r[0].style.filter="invert(0%)",l&&l.length>0&&(l[0].style.color="black"),i=p):"esriWITileLayer"===e?(t[0].style.backgroundImage="var(--gradientBlue)",t[0].style.color="beige",n[0].style.filter="invert(100%)",o[0].style.filter="invert(100%)",a[0].style.filter="invert(100%)",r[0].style.filter="invert(100%)",l&&l.length>0&&(l[0].style.color="beige"),i=c):"blackTileLayer"===e&&(t[0].style.backgroundImage="var(--gradientGray)",t[0].style.color="gray",n[0].style.filter="invert(100%)",o[0].style.filter="invert(100%)",a[0].style.filter="invert(100%)",r[0].style.filter="invert(100%)",l&&l.length>0&&(l[0].style.color="gray"),i=d);let u=g.Map.getLayerGroup().getLayers();u.insertAt(0,i)}}function o(){g.Map.addControl(new ol.control.ZoomSlider),g.Map.addControl(new ol.control.Zoom),g.Map.addControl(new ol.control.FullScreen),g.Map.addControl(new ol.control.Rotate({autoHide:!1,class:"ol-rotate"}));let e=new ol.control.MousePosition({projection:App4Sea.prefProj,coordinateFormat:function(e){let t=ol.proj.transform(e,App4Sea.prefProj,App4Sea.prefViewProj),n=ol.coordinate.toStringHDMS(e);return n=n+"<br>"+ol.coordinate.toStringXY(e,6),n=n+"<br>"+ol.coordinate.toStringXY(t,0),n},undefinedHTML:""});g.Map.addControl(e),g.Map.addControl(new ol.control.OverviewMap({layers:[i],collapsed:!0})),g.Map.addControl(new ol.control.ScaleLine)}function a(){App4Sea.TreeMenu.SetUp(),App4Sea.TreeInfo.SetUp(),$("#MenuContainer input[type='checkbox']").click(function(){n()}),$("#MenuContainer select").change(function(){n()})}function r(){const e=document.getElementById("popup"),t=document.getElementById("popup-closer");App4Sea.PopUps.overlayLayerPopUp=l(e,t),g.Map.addOverlay(App4Sea.PopUps.overlayLayerPopUp),App4Sea.PopUps.initToolTip()}function l(e,t){var n=new ol.Overlay({element:e,autoPan:!0,autoPanAnimation:{duration:2e3}});return t&&(t.onclick=function(){return n.setPosition(void 0),t.blur(),!1}),n}let i,s,p,c,d,g={};return g.Map,g.styleMaps=[],g.layers=[],g.descriptionContainer,g.Init=function(){e(),t(),i=p,n(),o(),a(),r()},g.MapChange=function(){let e=$("#MenuLayer_Select2"),t=$("#MenuLayer_Select");t[0].selectedIndex=e[0].selectedIndex,n()},g}(),App4Sea.OpenLayers=App4SeaOpenLayers,App4SeaPopUps=function(){"use strict";function e(e){let t={name:"",vessel_IMO:"",vessel_MMSI:"",SiteID:"",address:"",location:"",description:"",operation:"",vessel_class:"",vessel_loa:"",vessel_breadth:"",vessel_draught:"",vessel_GT:"",vessel_averageSpeed:"",vessel_build:"",equipment_crane:"",equipment_craneCapability:"",equipment_totalStorageCapacity:"",descripequipment_heatedStoragetion:"",linkinfo:"",linkicon:"",linkimage:"",linkvideo:""};t.name=e[0].get("name"),t.vessel_IMO=e[0].get("vessel_IMO"),t.vessel_MMSI=e[0].get("vessel_MMSI"),t.SiteID=e[0].get("SiteID"),t.address=e[0].get("address"),t.location=e[0].get("location"),t.description=e[0].get("description"),t.operation=e[0].get("operation"),t.vessel_class=e[0].get("vessel_class"),t.vessel_loa=e[0].get("vessel_loa"),t.vessel_breadth=e[0].get("vessel_breadth"),t.vessel_draught=e[0].get("vessel_draught"),t.vessel_GT=e[0].get("vessel_GT"),t.vessel_averageSpeed=e[0].get("vessel_averageSpeed"),t.vessel_build=e[0].get("vessel_build"),t.equipment_crane=e[0].get("equipment_crane"),t.equipment_craneCapability=e[0].get("equipment_craneCapability"),t.equipment_totalStorageCapacity=e[0].get("equipment_totalStorageCapacity"),t.equipment_heatedStorage=e[0].get("equipment_heatedStorage"),t.linkinfo=e[0].get("linkinfo"),t.linkicon=e[0].get("linkicon"),t.linkimage=e[0].get("linkimage"),t.linkvideo=e[0].get("linkvideo");const n='<div style="margin:2px;"><table>\n        <tr><td>IMO</td><td><b>{{vessel_IMO}}</b></td></tr>\n        <tr><td>MMSI</td><td><b>{{vessel_MMSI}}</b></td></tr>\n        <tr><td>Site ID</td><td><b>{{SiteID}}</b></td></tr>\n        <tr><td>Address</td><td><b>{{address}}</b></td></tr>\n        <tr><td>Location</td><td><b>{{location}}</b></td></tr>\n        <tr><td>Description</td><td><b>'+t.description+"</b></td></tr>\n        <tr><td>Operation</td><td><b>{{operation}}</b></td></tr>\n        <tr><td>Class</td><td><b>{{vessel_class}}</b></td></tr>\n        <tr><td>LOA</td><td><b>{{vessel_loa}}</b></td></tr>\n        <tr><td>Breadth</td><td><b>{{vessel_breadth}}</b></td></tr>\n        <tr><td>Draught</td><td><b>{{vessel_draught}}</b></td></tr>\n        <tr><td>GT</td><td><b>{{vessel_GT}}</b></td></tr>\n        <tr><td>Average speed</td><td><b>{{vessel_averageSpeed}}</b></td></tr>\n        <tr><td>Build year</td><td><b>{{vessel_build}}</b></td></tr>\n        <tr><td>Crane</td><td><b>{{equipment_crane}}</b></td></tr>\n        <tr><td>Crane capability</td><td><b>{{equipment_craneCapability}}</b></td></tr>\n        <tr><td>Total storage capacity</td><td><b>{{equipment_totalStorageCapacity}}</b></td></tr>\n        <tr><td>Heated storage</td><td><b>{{equipment_heatedStorage}}</b></td></tr>\n        <tr><td>Information</td><td><b>"+t.linkinfo+"</b></td></tr>\n        <tr><td>Icon</td><td><img class='osr-image' src='{{linkicon}}' alt=''><img></td></tr>\n        <tr><td>Image</td><td><img class='osr-image' src='{{linkimage}}' alt=''><img></td></tr>\n        <tr><td>Video</td><td><video class='osr-video' src='{{linkvideo}}' alt='' autoplay controls></video></td></tr>\n        </table></div>";Mustache.parse(n);let o=Mustache.to_html(n,t);return o}function t(e){let t={name:"",SiteID:"",address:"",description:"",linkinfo:"",linkicon:"",linkimage:"",linkvideo:""};t.name=e[0].get("name"),t.SiteID=e[0].get("SiteID"),t.address=e[0].get("address"),t.description=e[0].get("description"),t.equipment_totalStorageCapacity=e[0].get("equipment_totalStorageCapacity"),t.equipment_heatedStorage=e[0].get("equipment_heatedStorage"),t.linkinfo=e[0].get("linkinfo"),t.linkicon=e[0].get("linkicon"),t.linkimage=e[0].get("linkimage"),t.linkvideo=e[0].get("linkvideo");const n='<div style="margin:2px;"><table>\n        <tr><td>Site ID</td><td><b>{{SiteID}}</b></td></tr>\n        <tr><td>Address</td><td><b>{{address}}</b></td></tr>\n        <tr><td>Description</td><td><b>'+t.description+"</b></td></tr>\n        <tr><td>Information</td><td><b>"+t.linkinfo+"</b></td></tr>\n        <tr><td>Icon</td><td><img class='osr-image' src='{{linkicon}}' alt=''><img></td></tr>\n        <tr><td>Image</td><td><img class='osr-image' src='{{linkimage}}' alt=''><img></td></tr>\n        <tr><td>Video</td><td><video class='osr-video' src='{{linkvideo}}' alt='' autoplay controls></video></td></tr>\n        </table></div>";Mustache.parse(n);let o=Mustache.to_html(n,t);return o}function n(e){let t={name:"",region:"",region2:"",region3:"",region4:"",address:"",link:""};t.name=e[0].get("navn"),t.address=e[0].get("gateadresse"),t.region=e[0].get("fylke"),t.region2=e[0].get("kyv_region"),t.region3=e[0].get("kommune"),t.region4=e[0].get("lua"),t.link=e[0].get("lenke_faktaark");const n='<div style="margin:2px;">\n                <tr><td>Address</td><td><b>{{address}}</b></td></tr>\n                <tr><td>Region</td><td><b>{{region}}</b></td></tr>\n                <tr><td>Coastguard region</td><td><b>{{region2}}</b></td></tr>\n                <tr><td>Commune</td><td><b>{{region3}}</b></td></tr>\n                <tr><td>LUA</td><td><b>{{region4}}</b></td></tr>\n                <tr><td>Link</td><td><b>'+t.link+"</b></td></tr>\n            </div>";Mustache.parse(n);let o=Mustache.to_html(n,t);return o}function o(e){let t={name:"",callsign:"",type:"",cargotype:"",flag:""};t.name=e[0].get("Name"),t.callsign=e[0].get("Call_Sign"),t.type=e[0].get("Type"),t.cargotype=e[0].get("Cargo_Type"),t.flag=e[0].get("Flag");const n='<div style="margin:2px;"><table>\n                <tr><td>Call sign</td><td><b>{{callsign}}</b></td></tr>\n                <tr><td>Type</td><td><b>{{type}}</b></td></tr>\n                <tr><td>Cargo type</td><td><b>{{cargotype}}</b></td></tr>\n                <tr><td>Flag</td><td><b>{{flag}}</b></td></tr>\n            </table></div>';Mustache.parse(n);let o=Mustache.to_html(n,t);return o}function a(e){let t;if("styleUrl"===e.nodeName)for(var n=App4Sea.OpenLayers.styleMaps.length-1;n>=0;n--){var o=App4Sea.Utils.parseURL(e.innerHTML);if("#"+App4Sea.OpenLayers.styleMaps[n].id===o.hash&&(t=a(App4Sea.OpenLayers.styleMaps[n].node),t))return t}if("BalloonStyle"===e.nodeName&&e.children.length>0)return t=e.children[0].innerHTML,t;for(let n=0;n<e.children.length;n++){let o=e.children[n];if(t=a(o),t)return t}return t}function r(e){let t=e.get("name");return t||(t=e.get("navn")),t}let l={};l.overlayLayerPopUp;const i=document.getElementById("popup-content"),s=document.getElementById("popup-closer"),p=document.getElementById("popup-title");return l.SingleClick=function(c){if("NotActive"!==App4Sea.Measure.GetType())return;let d=c.coordinate,g=[];if(App4Sea.OpenLayers.Map.forEachFeatureAtPixel(c.pixel,function(e){g.push(e)}),g.length>0){let s=g[0].get("description");g[0].get("vessel_IMO")?s=e(g):g[0].get("SiteID")?s=t(g):g[0].get("navn")?s=n(g):g[0].get("Id")&&(s=o(g)),s||(s=g[0].get("name"));let c,u=g[0].get("styleUrl");for(let e=App4Sea.OpenLayers.styleMaps.length-1;e>=0;e--){let t=App4Sea.Utils.parseURL(u);if("#"+App4Sea.OpenLayers.styleMaps[e].id===t.hash&&(c=a(App4Sea.OpenLayers.styleMaps[e].node),c))break}if("$[description]"===c&&(c=s),c){let e=App4Sea.Utils.NoXML(c),t=e,n=t.replaceAll(/\$\[(.+?)\//,"{{");n=n.replaceAll("]","}}"),n=n.replaceAll("{{http","{{{http"),n=n.replaceAll(/{{{(.+?)}}/,/{{{(.+?)}}}/),s=App4Sea.PopUps.PopulateTemplate(n,g[0])}let m=r(g[0]);p.innerHTML=m||"",s&&(i.innerHTML=s,l.overlayLayerPopUp.setPosition(d))}else l.overlayLayerPopUp.setPosition(void 0),s.blur()},l.initToolTip=function(){let e=App4Sea.OpenLayers.Map,t=function(t){$("#ToolTipInfo").css({left:t[0]+"px",top:t[1]-15+"px"});let n=e.forEachFeatureAtPixel(t,function(e,t){return e});if(n){let e=r(n);if(e){let t=$("#ToolTipInfo");t.tooltip("hide").attr("data-original-title",e).tooltip("show")}else $("#ToolTipInfo").tooltip("hide")}else $("#ToolTipInfo").tooltip("hide")};e.on("pointermove",function(n){n.dragging?$("#ToolTipInfo").tooltip("hide"):t(e.getEventPixel(n.originalEvent))}),$(e.getViewport()).on("mousemove",function(n){t(e.getEventPixel(n.originalEvent))})},l.PopulateTemplate=function(e,t){Mustache.parse(e);let n=Mustache.to_html(e,t.values_);return n},l}(),App4Sea.PopUps=App4SeaPopUps,App4SeaTreeInfo=function(){"use strict";let e={},t=0,n=[];return e.SetUp=function(){function e(e){let t
;return t="#"===e.id?"json/info.json":"json/"+e.id+".json",t}function o(e){$("#TreeInfo").jstree({core:{check_callback:!1,themes:{dots:!1,icons:!1},error:function(e){App4Sea.logging&&console.log("Error: "+e.error),App4Sea.logging&&console.log("Id: "+e.id),App4Sea.logging&&console.log("Plugin: "+e.plugin),App4Sea.logging&&console.log("Reason: "+e.reason),App4Sea.logging&&console.log("Data: "+e.data)},data:e},plugins:[]})}function a(e,n,o,r){function l(e,n,o,r){return function(e,l,i){for(var s=0;s<e.length;s++){let t=e[s],l=t.children;t.children=!1,r.push(t),l&&a(t,n,o,r)}t--,0===t&&n(r)}}function i(e,n,o){return function(a,r,l){App4Sea.logging&&console.log(a),App4Sea.logging&&console.log(r),App4Sea.logging&&console.log(l),App4Sea.logging&&console.log(e),t--,0===t&&(App4Sea.logging&&console.log("WE ARE DONE WITH ERROR! "+n),n(o))}}let s=o(e);t++,jQuery.ajax({url:s,contentType:"application/json; charset=utf-8",type:"GET",dataType:"JSON",cache:!1,async:!0,success:l(e,n,o,r),error:i(e,n,r)})}a({id:"#"},o,e,n),$("#TreeInfo").on("changed.jstree",function(e,t){App4Sea.logging&&console.log("On: "+t.selected),void 0!==t.node&&""!==t.node.a_attr.path&&window.open(t.node.a_attr.path)})},e}(),App4Sea.TreeInfo=App4SeaTreeInfo,App4SeaTreeMenu=function(){"use strict";function e(e,t,n){let o=App4Sea.OpenLayers.descriptionContainer,a=App4Sea.Utils.NoXML(n);o.innerHTML=a;let r=ol.proj.fromLonLat([0,55]),l=new ol.Overlay({position:r,positioning:"center-center",element:o,stopEvent:!1});App4Sea.OpenLayers.Map.addOverlay(l)}function t(){var e=App4Sea.OpenLayers.descriptionContainer;e.innerHTML=""}let n={},o=0,a=[];return n.SetUp=function(){function n(e,t){let n;return n="#"===e.id?"json/"+t:"json/"+e.id+".json",n}function r(e){$("#TreeMenu").jstree({checkbox:{keep_selected_style:!1,real_checkboxes:!0},plugins:["checkbox","context"],core:{check_callback:function(e,t,n,o,a){return"create_node"===e},themes:{dots:!1,icons:App4Sea.useIconsInMenu},error:function(e){App4Sea.logging&&console.log("Error: "+e.error),App4Sea.logging&&console.log("Id: "+e.id),App4Sea.logging&&console.log("Plugin: "+e.plugin),App4Sea.logging&&console.log("Reason: "+e.reason),App4Sea.logging&&console.log("Data: "+e.data)},data:e}})}function l(e,t,n,a,r){function i(e,t,n,a,r){return function(e,i,s){for(var p=0;p<e.length;p++){let o=e[p],i=o.children;o.children=!1,r.push(o),i&&l(o,t,n,a,r)}o--,0===o&&t(r)}}function s(e,t,n){return function(a,r,l){App4Sea.logging&&console.log(a),App4Sea.logging&&console.log(r),App4Sea.logging&&console.log(l),App4Sea.logging&&console.log(e),o--,0===o&&(App4Sea.logging&&console.log("WE ARE DONE WITH ERROR! "+t),t(n))}}let p=n(e,a);o++,jQuery.ajax({url:p,contentType:"application/json; charset=utf-8",type:"GET",dataType:"JSON",cache:!1,async:!0,success:i(e,t,n,a,r),error:s(e,t,r)})}l({id:"#"},r,n,"a4s.json",a),$("#TreeMenu").on("changed.jstree",function(n,o){if(void 0!==o.node){var a=$(this).jstree("get_node",o.node.id);t();for(var r=0;r<App4Sea.OpenLayers.layers.length;r++){for(var l=App4Sea.OpenLayers.Map.getLayers(),i=App4Sea.OpenLayers.layers[r].vector.ol_uid,s=App4Sea.Utils.alreadyActive(i,l),p=!1,c=0;c<o.selected.length;c++)if(o.selected[c]===App4Sea.OpenLayers.layers[r].id){p=!0;break}p||-1===s||App4Sea.OpenLayers.Map.removeLayer(App4Sea.OpenLayers.layers[r].vector)}"Description"===a.text||"Author"===a.text?a.state.selected&&e(a.text,a.id,a.data):a.text;for(var d=0;d<o.selected.length;d++){var g=$(this).jstree("get_node",o.selected[d]),u=App4Sea.Utils.alreadyLayer(g.id,App4Sea.OpenLayers.layers);if(-1!==u){l=App4Sea.OpenLayers.Map.getLayers(),i=App4Sea.OpenLayers.layers[u].vector.ol_uid,s=App4Sea.Utils.alreadyActive(i,l);-1===s&&(App4Sea.OpenLayers.Map.addLayer(App4Sea.OpenLayers.layers[u].vector),App4Sea.Utils.LookAt(App4Sea.OpenLayers.layers[u].vector));continue}let e=g.a_attr.path,t=g.a_attr.tool;g.a_attr.projection;if("animation"===t?App4Sea.Utils.w3_open("AnimationContainer"):"heat"===t&&App4Sea.Utils.w3_open("HeatContainer"),e&&""!==e)if("heat"===t){if(-1===u){let t=App4Sea.Utils.heatMap(e,g.id,g.text);App4Sea.OpenLayers.layers.push({id:g.id,vector:t}),App4Sea.logging&&console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(t),App4Sea.Utils.LookAt(t)}}else if(e.length>3){let t=e.toLowerCase().substr(e.length-3,3);if("1cd"===t){if(-1===u){let t=App4Sea.Weather.loadWeather(e,g.id);App4Sea.OpenLayers.layers.push({id:g.id,vector:t}),App4Sea.logging&&console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(t),App4Sea.Utils.LookAt(t)}}else if("6e4"===t){if(-1===u){App4Sea.Weather.loadCityWeather(e,g.id)}}else if("wms"===t||"gif"===t||"cgi"===t||"png"===t||"jpg"===t){if(-1===u){let n=App4Sea.Utils.parseURL(e.toLowerCase()),o=n.searchObject.bbox,a=App4Sea.prefProj;void 0!==n.searchObject.crs&&(a=n.searchObject.crs),void 0!==n.searchObject.scs&&(a=n.searchObject.srs),App4Sea.logging&&console.log("Now handling a "+t+" file with projection:  "+a);let r=[-10,50,10,70],l=App4Sea.prefViewProj;if(void 0!==o)try{let t=o.split(","),n=[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];r=App4Sea.Utils.TransformExtent(n,a.toUpperCase(),l),App4Sea.logging&&console.log("Native extent "+t),App4Sea.logging&&console.log("Normalized extent "+r)}catch(t){App4Sea.logging&&console.log("Could not find extent for image at "+e)}let i=parseFloat(n.searchObject.height),s=parseFloat(n.searchObject.width);null===i&&(i=g.a_attr.height),null===s&&(s=g.a_attr.width),null===i&&(i=512),null===s&&(s=512),App4Sea.logging&&console.log("Height and width is "+[i,s]);let p=App4Sea.Utils.loadImage(g,l,r,!0,e,g.id,g.text,"",s,i,g.a_attr.start);App4Sea.OpenLayers.layers.push({id:g.id,vector:p}),App4Sea.logging&&console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(p),App4Sea.Utils.LookAt(p)}}else-1===u&&(App4Sea.KML=App4SeaKML,App4Sea.KML.loadKmlKmz(e,g.id,g.text))}}}})},n.Checkbox=function(e,t){t?$.jstree.reference("#TreeMenu").check_node(e):$.jstree.reference("#TreeMenu").uncheck_node(e)},n}(),App4Sea.TreeMenu=App4SeaTreeMenu,App4SeaUtils=function(){"use strict";let e={};const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.GetKMLFromFeatures=function(e,t){let n=new ol.format.KML({maxDepth:10,writeStyles:!0,internalProjection:App4Sea.prefViewProj,externalProjection:App4Sea.prefProj}),o="<?xml version='1.0' encoding='utf-8'?>",a=n.writeFeatures(e,{featureProjection:App4Sea.prefViewProj,externalProjection:App4Sea.prefProj}),r=a.match(/<coordinates>(.|\n)*?<\/coordinates>/g);if(r){let e=!1;for(let t=0;t<r.length;t++){let n=r[t].match(/[\ \,]/g);n&&" "===n[1]&&(e=!0)}if(e){let e=a.match(/<coordinates>(.|\n)*? /g);for(;e&&e.length>0;)a=a.replace(e[0],e[0].substr(0,e[0].length-1)+"Ðð"),e=a.match(/<coordinates>(.|\n)*? /g);a=a.replaceAll("Ðð",",0 ")}}let l="";return o+a+l},e.DoSaveKML=function(e,t){let n=document.createElement("a");if(n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),document.createEvent){let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),n.dispatchEvent(e)}else n.click()},e.altitudeToZoom=function(e){const t=40487.57,n=7096758e-11,o=91610.74,a=-40467.74;return a+(t-a)/(1+Math.pow(e/o,n))},e.GoHome=function(){let e=App4Sea.OpenLayers.Map.getView();e.setZoom(App4Sea.startZoom),e.setCenter(App4Sea.mapCenter)},e.GetFeaturesExtent=function(e){if(!e||0===e.length)return;let t=ol.extent.createEmpty();for(let n=0;n<e.length;n++)t=ol.extent.extend(t,e[n].getGeometry().getExtent());return App4Sea.logging&&console.log("Extent is: "+t),t},e.TransformExtent=function(e,t,n){let o=e;if(t!==n)try{ext=ol.proj.transformExtent(e,t,n)}catch(a){try{proj4.defs("EPSG:3575","+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs");let a=proj4(t,n,[e[0],e[1]]),r=proj4(t,n,[e[2],e[3]]);o=a,o.push(r[0]),o.push(r[1])}catch(e){App4Sea.logging&&console.log(e)}}return App4Sea.logging&&console.log("Transform extent from: "+t+": "+e+" to: "+n+": "+o),o},e.LookAt=function(e){if(null===e)return void(App4Sea.logging&&console.log("Can't look at null"));let t,n;e.getExtent&&(t=e.getExtent()),e.getProjection&&(n=e.getProjection());let o=e.type;if(App4Sea.logging&&console.log("Look at vector of type: "+o),void 0!==n&&App4Sea.logging&&console.log("Look at vector with proj: "+n.getCode()+" and "+t),e.getSource){let a=e.getSource();if("IMAGE"===o&&(t=a.getImageExtent(),n=a.getProjection(),App4Sea.logging&&console.log("Look at IMAGE with proj: "+n.getCode()+" and "+t),t=App4Sea.Utils.TransformExtent(t,n.getCode(),App4Sea.prefProj),n=App4Sea.prefProj,t&&t[0]!==Number.POSITIVE_INFINITY&&t[0]!==Number.NEGATIVE_INFINITY&&t[1])){App4Sea.logging&&console.log("Look at: "+t),App4Sea.logging&&console.log("Look at projection: "+n),n!==App4Sea.prefProj&&(t=t);let e=t[0]+t[2],o=t[1]+t[3],a=[e/2,o/2];App4Sea.Utils.FlyTo(a,null)}}},e.toggleFullscreen=function(){document.fullscreenEnabled?App4Sea.logging&&console.log("Fullscreen is possible in browser"):App4Sea.logging&&console.log("Fullscreen is not possible in browser"),document.fullscreenElement?e.closeFullscreen():e.openFullscreen()},e.openFullscreen=function(){let e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},e.closeFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},e.parseURL=function(e){let t,n,o,a=document.createElement("a"),r={};for(a.href=e,t=a.search.replace(/^\?/,"").split("&"),o=0;o<t.length;o++)n=t[o].split("="),r[n[0]]=n[1];return{protocol:a.protocol,host:a.host,hostname:a.hostname,port:a.port,pathname:a.pathname,search:a.search,searchObject:r,hash:a.hash}},e.CheckChanged=function(e){},e.SelectAuthority=function(e){let t="- To be done -",n="- To be done -",o="- To be done -";const a=document.getElementById("AuthorityNotify"),r=document.getElementById("AuthorityNational"),l=document.getElementById("AuthorityWeather");"Iceland"===e&&(t="Operations Centre<br/>             The Icelandic Coastguard<br/>              P.O. 7120 127 Reykjavik<br/>             Tel:    +354-545 2100 (24 hr)<br/>             Fax:    +354-545 2001<br/>             Email:  sar@lhg.is<br/>             Web: www.lhg.is<br/>",n="Environmental Agency of Iceland (EAI) (Oil & HNS)<br/>             Suðurlandsbraut 24 108 Reykjavik<br/>             Tel:    +354-591 2000<br/>             Mobile: +354 822 4003<br/>             Fax:\t+354-591 2010<br/>             Email:  ust@ust.is<br/>             Web:\twww.ust.is<br/>"),a.innerHTML=t,r.innerHTML=n,l.innerHTML=o},String.prototype.replaceAll=function(e,t){let n=this;return n.replace(new RegExp(e,"g"),t)},e.ReplaceAll=String.prototype.replaceAll,e.drawSquare=function(t){let n={myBox:t},o=new ol.layer.Tile({extent:n.myBox,source:new ol.source.TileJSON({url:"https://api.tiles.mapbox.com/v3/mapbox.world-light.json?secure",crossOrigin:"anonymous"})});App4Sea.OpenLayers.Map.addLayer(o),e.LookAt(o)},e.loadXMLDoc=function(e){let t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),loadResonse(t)},e.loadResponse=function(e){let t=e.responseXML;return t},e.heatMap=function(e,t,n){const o=document.getElementById("titleHeatMap"),a=document.getElementById("blur"),r=document.getElementById("radius");o.innerHTML=n;const l=new ol.layer.Heatmap({source:new ol.source.Vector({crossOrigin:"anonymous",url:e,format:new ol.format.KML({extractStyles:!1})}),blur:parseInt(a.value,10),radius:parseInt(r.value,10)});return l.getSource().on("addfeature",function(e){const t=e.feature.get("name");if(t){const n=parseFloat(t.substr(2));e.feature.set("weight",n-5)}else{const t=parseFloat(e.feature.values_.SURFACE);e.feature.set("weight",t-33)}}),a.addEventListener("input",function(){l.setBlur(parseInt(a.value,10))},!1,{passive:!0}),r.addEventListener("input",function(){l.setRadius(parseInt(r.value,10))},!1,{passive:!0}),l},e.loadImage=function(e,t,n,o,a,r,l,i,s,p,c){a=a.replaceAll(/&amp;/,"&"),App4Sea.logging&&console.log("loadImage: "+a),t!==App4Sea.prefProj&&App4Sea.logging&&console.log("loadImage ERROR. Wrong projection: "+t),(Math.max(n)>180||Math.min(n<180))&&App4Sea.logging&&console.log("loadImage ERROR. Wrong extent: "+n);let d=l;a=a.toLowerCase(),App4Sea.logging&&console.log("loadImage proj: "+t),App4Sea.logging&&console.log("loadImage imageExtent: "+n);let g=new ol.layer.Image({name:d,source:new ol.source.ImageStatic({url:a,imageExtent:n,projection:t,crossOrigin:"anonymous"})});return g},e.alreadyLayer=function(e,t){let n=t.length;for(let o=0;o<n;o++)if(t[o].id===e)return o;return-1},e.alreadyActive=function(e,t){let n=t.array_,o=n.length;for(let t=0;t<o;t++)if(n[t].ol_uid===e)return t;return-1},e.supports_html5_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},e.NoXML=function(e){let t,n=e.trim();return t=n.startsWith("<![CDATA[")?n.substr(9,n.length-12):n,t},e.allowDrop=function(e){e.preventDefault()},e.drag=function(e){App4Sea.logging&&console.log("Drag"),e.dataTransfer.setData("id",e.target.id),e.dataTransfer.setData("title",e.target.name),App4Sea.logging&&console.log(e.target.id),App4Sea.logging&&console.log(e.target.name)},e.drop=function(e){App4Sea.logging&&console.log("Drop"),e.preventDefault();let t=e.dataTransfer.getData("id"),n=e.dataTransfer.getData("title");App4Sea.logging&&console.log(t),App4Sea.logging&&console.log(n)},e.PutPlacemark=function(){let t=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.6,src:"icons/VesselAndOil.svg",scale:1})}),n=new ol.source.Vector({}),o=App4Sea.OpenLayers.Map.getView().getCenter(),a=ol.proj.transform([21,63],App4Sea.prefProj,App4Sea.prefViewProj);a=o;for(let e=0;e<1;e++){let t=new ol.Feature({geometry:new ol.geom.Point(a),name:"Placemark "+e,type:"Placemark"});t.on("change",function(){console.log("Feature Moved To:"+this.getGeometry().getCoordinates())},t),n.addFeature(t);let o=new ol.interaction.Modify({features:new ol.Collection([t]),style:null});App4Sea.OpenLayers.Map.addInteraction(o)}let r=new ol.layer.Vector({source:n,style:t});App4Sea.OpenLayers.Map.addLayer(r),e.LookAt(r)},e.PrintReport=function(){};let n=function(){g.remove("#ControlPlaceInMenu"),$(g).appendTo("#ControlPlaceInMap"),u.remove("#ControlPlaceInMenu"),$(u).appendTo("#ControlPlaceInMap"),y.remove("#ControlPlaceInMenu"),$(y).appendTo("#ControlPlaceInMap"),m.remove("#ControlPlaceInMenu"),$(m).appendTo("#ControlPlaceInMap"),f.remove("#ControlPlaceInMenu"),$(f).appendTo("#ControlPlaceInMap");const e="none"!==g.style.display,t="none"!==u.style.display,n="none"!==y.style.display,o="none"!==m.style.display,a="none"!==f.style.display;e||t||n||o||a?(c.style.visibility="visible",d.style.visibility="visible"):(c.style.visibility="hidden",d.style.visibility="hidden")},o=function(){g.remove("#ControlPlaceInMap"),$(g).appendTo("#ControlPlaceInMenu"),u.remove("#ControlPlaceInMap"),$(u).appendTo("#ControlPlaceInMenu"),y.remove("#ControlPlaceInMap"),$(y).appendTo("#ControlPlaceInMenu"),m.remove("#ControlPlaceInMap"),$(m).appendTo("#ControlPlaceInMenu"),f.remove("#ControlPlaceInMap"),$(f).appendTo("#ControlPlaceInMenu"),c.style.visibility="hidden",d.style.visibility="hidden"},a=function(e){let t=!0;return $(e+" li.jstree-open").length&&(t=!1),t};e.collapse_tree=function(e,t,n){const o=$(t);n?a(t)?(o[0].style.visibility="hidden",o[0].style.height=0):$(t).jstree(!1).close_all():"hidden"===o[0].style.visibility?(o[0].style.visibility="visible",o[0].style.height="100%"):$(t).jstree(!1).open_all()},e.section_toggle=function(t){const a=document.getElementById(t);if(null!==a&&"none"===a.style.display)if(e.w3_open(t),"MenuContainer"===t)o();else{const e=document.getElementById("MenuContainer");"block"===e.style.display?o():n()}else e.w3_close(t)},e.w3_open=function(e){const t=document.getElementById(e);if(null!==t&&(t.style.display="block"),window.innerWidth<600){let e=document.getElementsByClassName("ol-control");for(let t=0;t<e.length;t++)e[t].classList.add("hidden")}if("MenuContainer"===e&&($("#TreeMenu").jstree(!0).close_all(),o(),S.style.display="none",window.innerWidth<=500))for(let e=0;e<h.length;e++)h[e].style.display="none"},e.w3_close=function(e){const t=document.getElementById(e);null!==t&&(t.style.display="none");let o=document.getElementsByClassName("ol-control");for(let e=0;e<o.length;e++)o[e].classList.remove("hidden");if("MenuContainer"===e){n(),S.style.display="block";for(let e=0;e<h.length;e++)h[e].style.display="block"}g.style.display,u.style.display,y.style.display,m.style.display;"HeatContainer"===e&&null!==g&&(g.style.display="none"),"AnimationContainer"===e&&null!==u&&(u.style.display="none"),"LogContainer"===e&&null!==m&&(m.style.display="none"),"MeasurementContainer"===e&&null!==y&&(y.style.display="none");let a=0;for(let e=0;e<c.children.length;e++)"none"!==c.children[e].style.display&&a++;1===a&&(c.style.visibility="hidden",d.style.visibility="hidden")},e.copyToClipboard=function(e){console.log(e);let t=document.createElement("img");t.src=e,console.log(e),document.body.appendChild(t);let n=document.createRange();n.setStartBefore(t),n.setEndAfter(t),n.selectNode(t);let o=window.getSelection();o.addRange(n);try{let e=document.execCommand("Copy"),t=e?"successful":"NOT successful";console.log("Copying was "+t)}catch(e){console.log("Oops, unable to copy: "+e)}document.body.removeChild(t)};let r={filter:function(e){return!e.className||-1===e.className.indexOf("ol-control")}};e.take_screenshot=function(){console.log("take_screenshot"),toPng(document.body,r).then(function(t){e.copyToClipboard(t)}),App4Sea.OpenLayers.Map.renderSync()},e.Base64Encode=function(e){let n,o,a,r,i,s,p,c="",d=0;for(e=l(e);d<e.length;)n=e.charCodeAt(d++),o=e.charCodeAt(d++),a=e.charCodeAt(d++),r=n>>2,i=(3&n)<<4|o>>4,s=(15&o)<<2|a>>6,p=63&a,isNaN(o)?s=p=64:isNaN(a)&&(p=64),c=c+t.charAt(r)+t.charAt(i)+t.charAt(s)+t.charAt(p);return c},e.Base64Decode=function(e){let n,o,a,r,l,s,p,c="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)r=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),s=t.indexOf(e.charAt(d++)),p=t.indexOf(e.charAt(d++)),n=r<<2|l>>4,o=(15&l)<<4|s>>2,a=(3&s)<<6|p,c+=String.fromCharCode(n),64!==s&&(c+=String.fromCharCode(o)),64!==p&&(c+=String.fromCharCode(a));return c=i(c),c};let l=function(e){e=e.replace(/\r\n/g,"\n");let t="";for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},i=function(e){let t="",n=0,o=c1=c2=0;for(;n<e.length;)o=e.charCodeAt(n),o<128?(t+=String.fromCharCode(o),n++):o>191&&o<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),n+=3);return t};e.clearLog=function(){const e=document.getElementById("Log");e.innerHTML=""};let s=function(e){e=e||window.event;let t=["X","Y"];if(e.clientX)t.X=e.clientX,t.Y=e.clientY;else{let n=e.touches[0],o=n.pageX,a=n.pageY;t.X=o,t.Y=a}return t},p=function(e){function t(e){if(e=e||window.event,"DragHandle"===e.target.id){e.preventDefault();let t=s(e);c=t.X,d=t.Y}}function n(e){e=e||window.event,"DragHandle"===e.target.id&&(e.preventDefault(),r(e))}function o(e){e=e||window.event,"DragHandle"===e.target.id&&e.preventDefault()}function a(e){if(e=e||window.event,"DragHandle"===e.target.id){e.preventDefault();let t=s(e);c=t.X,d=t.Y,document.onmouseup=l,document.onmousemove=r}}function r(t){t=t||window.event,t.preventDefault();let n=s(t);window.innerWidth>500?(i=c-n.X,c=n.X,e.style.left=e.offsetLeft-i+"px"):(i=c-n.X,c=n.X,e.style.left="0px");let o=e.clientWidth/2+.5;e.offsetLeft-o>window.innerWidth-40?e.style.left=window.innerWidth-40+o+"px":e.offsetLeft-o+e.clientWidth<40&&(e.style.left=40-e.clientWidth+o+"px"),p=d-n.Y,d=n.Y,e.style.top=e.offsetTop-p+"px"}function l(e){e=e||window.event,document.onmouseup=null,document.onmousemove=null}let i=0,p=0,c=0,d=0;e.addEventListener("touchstart",t,!1,{passive:!1}),e.addEventListener("touchmove",n,!1,{passive:!1}),e.addEventListener("touchend",o,!1,{passive:!1}),e.onmousedown=a,e.touchstart=t};e.FlyTo=function(e,t){function n(e){--i,s||0!==i&&e||(s=!0,t&&t(e))}if(null==e)return;let o=App4Sea.Animation.getAnimationState();if("Stopped"!==o)return;let a=App4Sea.OpenLayers.Map.getView(),r=2e3,l=a.getZoom(),i=2,s=!1;(Math.max(e)>180||Math.min(e<180))&&App4Sea.logging&&console.log("FlyTo ERROR. Wrong extent: "+e);let p=ol.proj.transform(e,App4Sea.prefProj,App4Sea.prefViewProj);a.animate({center:p,duration:r},n),a.animate({zoom:l-1,duration:r/2},{zoom:l,duration:r/2},n)};const c=document.getElementById("ControlPlaceInMap"),d=document.getElementById("DragHandle"),g=document.getElementById("HeatContainer"),u=document.getElementById("AnimationContainer"),m=document.getElementById("LogContainer"),y=document.getElementById("MeasurementContainer"),f=document.getElementById("OperationContainer"),S=document.getElementById("ToolButtonsPlaceInMap"),h=document.getElementsByClassName("ol-control");return p(c),e}(),App4Sea.Utils=App4SeaUtils,App4SeaWeather=function(){"use strict";var e={NotWorking:function(e){var t=e.coordinate,n=document.getElementById("popup-content"),o="<div id='openweathermap-widget-15' style='zoom: 0.8'></div>";n.innerHTML=o,window.myWidgetParam?window.myWidgetParam:window.myWidgetParam=[],window.myWidgetParam.push({id:15,cityid:"3413829",appid:"1326faa296b7e865683b67cdf8e5c6e4",units:"metric",containerid:"openweathermap-widget-15"}),function(){var e=document.createElement("script");e.async=!0,e.charset="utf-8",e.src="//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),App4Sea.PopUps.overlayLayerPopUp.setPosition(t)},loadCityWeather:function(e,t){var n=document.getElementById("popup-content"),o=App4Sea.OpenLayers.Map.getView().getCenter(),a="<div id='openweathermap-widget-15' style='zoom: 0.8'></div>";n.innerHTML=a,window.myWidgetParam?window.myWidgetParam:window.myWidgetParam=[],window.myWidgetParam.push({id:15,cityid:"3413829",appid:"1326faa296b7e865683b67cdf8e5c6e4",units:"metric",containerid:"openweathermap-widget-15"}),function(){var e=document.createElement("script");e.async=!0,e.charset="utf-8",e.src="//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),App4Sea.PopUps.overlayLayerPopUp.setPosition(o)},loadWeather:function(e,t){App4Sea.logging&&console.log("loadWeather: "+t+" from "+e);for(var n=ol.extent.getWidth(App4Sea.mapExtent)/256/4,o=new Array(App4Sea.maxZoom-App4Sea.minZoom+1),a=0,r=o.length;a<r;++a)o[a]=n/Math.pow(2,a);var l=new ol.tilegrid.TileGrid({extent:App4Sea.mapExtent,origin:[App4Sea.mapExtent[0],App4Sea.mapExtent[1]],resolutions:o,projection:App4Sea.OpenLayers.prefViewProj,tileSize:[256,256]}),i=new ol.layer.Tile({name:t,preload:0,opacity:.8,extent:App4Sea.mapExtent,minResolution:o[o.length-1],maxResolution:o[0],tileGrid:l,source:new ol.source.XYZ({crossOrigin:"anonymous",attributions:['&copy; <a href="https://openweathermap.org/">Open Weather Map</a>'],url:e})});return i}};return e}(),App4Sea.Weather=App4SeaWeather;