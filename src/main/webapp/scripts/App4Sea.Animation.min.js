App4Sea=App4Sea||{},App4Sea.Animation=function(){"use strict";var my={};function initInfo(){var el=document.getElementById("start");el.innerHTML=startDate.substr(startDate.length-8,8),(el=document.getElementById("current")).innerHTML=currentDate.substr(currentDate.length-8,8),(el=document.getElementById("end")).innerHTML=endDate.substr(endDate.length-8,8),(el=document.getElementById("startDate")).innerHTML=startDate.substr(0,10),(el=document.getElementById("currentDate")).innerHTML=currentDate.substr(0,10),(el=document.getElementById("endDate")).innerHTML=endDate.substr(0,10)}function updateInfo(){var el=document.getElementById("current");el.innerHTML=currentDate.substr(currentDate.length-8,8),(el=document.getElementById("currentDate")).innerHTML=currentDate.substr(0,10);var layerid=my.AniData[4][anindex],lind=findLayerIndex(layerid),remember=1,progress;console.log(my.AniData[0][anindex]),console.log(layerid),App4Sea.TreeMenu.Checkbox(layerid,!0);for(var lastanindex=anindex-1;lastanindex<0;)lastanindex+=count;layerid=my.AniData[4][lastanindex],App4Sea.TreeMenu.Checkbox(layerid,!1),document.getElementById("progress").value=100*anindex/count,(anindex+=1)===count&&(anindex=0)}function findLayerIndex(lind){for(var ynd=0;ynd<App4Sea.OpenLayers.layers.length;ynd++){var item;if(App4Sea.OpenLayers.layers[ynd].id===lind)return ynd}return-1}function timeElapsed(){return"Playing"!==state?(Stop(),void(state="Stopped")):null===timerId||null===my.AniData[0]?(Stop(),void(state="Stopped")):(currentDate=0!==my.AniData[1].length?my.AniData[1][anindex].innerHTML:my.AniData[2][anindex].innerHTML,void updateInfo())}my.Animate=function(url,name){var button=document.getElementById("playStop");button.removeEventListener("click",PlayStop),button.addEventListener("click",PlayStop,!1,{passive:!0}),"Stopped"!==state&&Stop(),state="Stopped";var ext=url.substr(url.length-3,3);"kml"!==ext&&"kmz"!==ext||(count=my.AniData[0].length,document.getElementById("title").innerText=name)};var PlayStop=function(){if("Stopped"===state||"Playing"===state){state="Transition";var btnImg=document.getElementById("playStopImg"),iconPath=btnImg.src,icon;"play.png"===iconPath.substr(iconPath.length-8,8)?(Stop(),Prepare(),btnImg.src="icons\\stop.png",timerId=window.setInterval(timeElapsed,1e3/frameRate),state="Playing"):(Stop(),state="Stopped")}},Prepare=function(){if(0!==count){for(var aind=0;aind<count;aind++)App4Sea.TreeMenu.Checkbox(my.AniData[4][aind],!1);0!==my.AniData[1].length?(startDate=my.AniData[1][0].innerHTML,endDate=my.AniData[1][my.AniData[1].length-1].innerHTML):(startDate=my.AniData[2][0].innerHTML,endDate=my.AniData[2][my.AniData[2].length-1].innerHTML),currentDate=startDate,initInfo()}},Stop=function(){var btnImg;state="Stopping",null!==timerId&&(window.clearInterval(timerId),timerId=null),document.getElementById("playStopImg").src="icons\\play.png"};my.AniData=[[],[],[],[],[]];var state="Stopped",count,endDate,startDate,currentDate,frameRate=1,timerId=null,anindex=0;return my}(App4Sea.Animation||{});