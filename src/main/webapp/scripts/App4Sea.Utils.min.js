App4Sea=App4Sea||{},App4Sea.Utils=function(){"use strict";var my={parseURL:function(url){var parser=document.createElement("a"),searchObject={},queries,split,i;for(parser.href=url,queries=parser.search.replace(/^\?/,"").split("&"),i=0;i<queries.length;i++)searchObject[(split=queries[i].split("="))[0]]=split[1];return{protocol:parser.protocol,host:parser.host,hostname:parser.hostname,port:parser.port,pathname:parser.pathname,search:parser.search,searchObject:searchObject,hash:parser.hash}}};return String.prototype.replaceAll=function(search,replacement){var target=this;return this.replace(new RegExp(search,"g"),replacement)},my.ReplaceAll=String.prototype.replaceAll,my.test=function(){console.log("Testing ..."),my.layers.length=0},my.drawSquare=function(ext){var extents={myBox:ext},overlay=new ol.layer.Tile({extent:extents.myBox,source:new ol.source.TileJSON({url:"https://api.tiles.mapbox.com/v3/mapbox.world-light.json?secure",crossOrigin:"anonymous"})});App4Sea.OpenLayers.Map.addLayer(overlay)},my.loadXMLDoc=function(filename){var xhttp=new XMLHttpRequest;return xhttp.open("GET",filename,!1),xhttp.send(),loadResonse(xhttp)},my.loadResponse=function(xml){var theXmlDoc;return xml.responseXML},my.b64toBlob=function(b64Data,contentType,sliceSize){contentType=contentType||"",sliceSize=sliceSize||512;for(var byteCharacters=atob(b64Data),byteArrays=[],offset=0;offset<byteCharacters.length;offset+=sliceSize){for(var slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length),i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}var blob;return new Blob(byteArrays,{type:contentType})},my.heatMap=function(url,id,name){var blur=document.getElementById("blur"),radius=document.getElementById("radius"),title;document.getElementById("titleHeatMap").innerHTML=name;var vector=new ol.layer.Heatmap({source:new ol.source.Vector({crossOrigin:"anonymous",url:url,format:new ol.format.KML({extractStyles:!1})}),blur:parseInt(blur.value,10),radius:parseInt(radius.value,10)});return vector.getSource().on("addfeature",function(event){var name=event.feature.get("name"),magnitude=parseFloat(name.substr(2));event.feature.set("weight",magnitude-5)}),blur.addEventListener("input",{passive:!0},function(){vector.setBlur(parseInt(blur.value,10))}),radius.addEventListener("input",{passive:!0},function(){vector.setRadius(parseInt(radius.value,10))}),vector},my.loadImage=function(flag,url,id,text,layers,width,height,start){var nameIs;url=url.replaceAll(/&amp;/,"&"),nameIs=text;let scale=.2,imageExtent=ol.proj.transformExtent([10,50,0,60],App4Sea.prefProj,App4Sea.prefViewProj),image;return new ol.layer.Image({name:nameIs,source:new ol.source.ImageStatic({url:url,imageExtent:imageExtent,crossOrigin:"anonymous"})})},my.loadImageFromBlob=function(text,name,id,ext){if(console.log("loadImageFromBlob: "+name),name.endsWith("mp3"))return void console.log("Not handling video for now");var blob,base64;if(text.type&&"application/octet-stream"===text.type)blob=text;else{var str;str=text.replace(/[\u00A0-\u2666]/g,function(c){return"&#"+c.charCodeAt(0)+";"}),base64=btoa(unescape(encodeURIComponent(str)));var end=name.substr(name.lastIndexOf(".")+1);blob=App4Sea.Utils.b64toBlob(base64,"image/"+end)}var urlCreator,imageUrl=(window.URL||window.webkitURL).createObjectURL(blob),img;document.querySelector("#photo").src=imageUrl;let loadImage=function(im,src){im.getImage().src=blob},image=new ol.layer.Image({source:new ol.source.ImageStatic({imageExtent:ext,imageSize:[1020,844],imageLoadFunction:loadImage,url:imageUrl})});return console.log("loadImageFromBlob image: "+id+" in file "+name+" DONE"),image},my.createCORSRequest=function(method,url){var xhr=new XMLHttpRequest;return"withCredentials"in xhr?xhr.open(method,url,!0):"undefined"!=typeof XDomainRequest?(xhr=new XDomainRequest).open(method,url):xhr=null,xhr},my.alreadyLayer=function(id,arr){for(var count=arr.length,i=0;i<count;i++)if(arr[i].id===id)return i;return-1},my.alreadyActive=function(ol_uid,layers){for(var arr=layers.array_,count=arr.length,i=0;i<count;i++)if(arr[i].ol_uid===ol_uid)return i;return-1},my.supports_html5_storage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},my.allowDrop=function(ev){ev.preventDefault()},my.drag=function(ev){console.log("Drag"),ev.dataTransfer.setData("id",ev.target.id),ev.dataTransfer.setData("title",ev.target.name),console.log(ev.target.id),console.log(ev.target.name)},my.drop=function(ev){console.log("Drop"),ev.preventDefault();var id=ev.dataTransfer.getData("id"),title=ev.dataTransfer.getData("title");console.log(id),console.log(title)},my.section_toggle=function(id){"none"===document.getElementById(id).style.display?my.w3_open(id):my.w3_close(id)},my.collapse_tree=function(btn,elem){var collapse=!1;$(elem+" li.jstree-open").length&&(collapse=!0),collapse?($(elem).jstree(!0).close_all(),btn.innerText="▼"):($(elem).jstree(!0).open_all(),btn.innerText="▲")},my.w3_open=function(id){"MenuContainer"===id&&$("#TreeMenu").jstree(!0).close_all(),document.getElementById(id).style.display="block"},my.w3_close=function(id){document.getElementById(id).style.display="none"},my}(App4Sea.Utils||{});