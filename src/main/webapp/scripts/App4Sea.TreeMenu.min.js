App4Sea=App4Sea||{},App4Sea.TreeMenu=function(){"use strict";var my={};const _play_="â–¶";function showMetadata(title,id,data){var elem=App4Sea.OpenLayers.descriptionContainer;elem.innerHTML=data;var pos=ol.proj.fromLonLat([0,55]),overlay=new ol.Overlay({position:pos,positioning:"center-center",element:elem,stopEvent:!1});App4Sea.OpenLayers.Map.addOverlay(overlay)}function hideMetadata(){var elem;App4Sea.OpenLayers.descriptionContainer.innerHTML=""}return my.setUp=function(){let JSONdata=[],ajaxCount=0;function setTree(tree){$("#TreeMenu").jstree({checkbox:{keep_selected_style:!1,real_checkboxes:!0},plugins:["dnd","checkbox","context"],core:{check_callback:function(operation,node,parent,position,more){return!0},themes:{dots:!1,icons:!1},error:function(e){console.log("Error: "+e.error),console.log("Id: "+e.id),console.log("Plugin: "+e.plugin),console.log("Reason: "+e.reason),console.log("Data: "+e.data)},data:tree}})}function getData(node){function onSuccess(data,status,jqXHR,parent_node){for(var i_success=0;i_success<data.length;i_success++){let thisNode=data[i_success],children=thisNode.children;thisNode.children=!1,JSONdata.push(thisNode),children&&getData(thisNode),console.log(parent_node.id+": "+thisNode.id+", text: "+thisNode.text+", path: "+thisNode.a_attr.path)}0===--ajaxCount&&(console.log("WE ARE DONE!"),setTree(JSONdata))}function onError(jqXHR,status,errorThrown,parent_node){console.log(jqXHR),console.log(status),console.log(errorThrown),console.log(parent_node),0===--ajaxCount&&(console.log("WE ARE DONE!"),setTree(JSONdata))}let jsonURL;jsonURL="#"===node.id?"json/a4s.json":"json/"+node.id+".json",ajaxCount++,jQuery.ajax({url:jsonURL,contentType:"application/json; charset=utf-8",type:"GET",dataType:"JSON",cache:!1,async:!0,success:function(data,status,jqXHR){onSuccess(data,status,jqXHR,node)},error:function(jqXHR,status,errorThrown){onError(jqXHR,status,errorThrown,node)}})}getData({id:"#"}),$("#TreeMenu").on("changed.jstree",function(e,data){if(void 0!==data.node){var node=$(this).jstree("get_node",data.node.id);hideMetadata();for(var lind=0;lind<App4Sea.OpenLayers.layers.length;lind++){for(var activeLayers=App4Sea.OpenLayers.Map.getLayers(),ol_uid=App4Sea.OpenLayers.layers[lind].vector.ol_uid,activeIndex=App4Sea.Utils.alreadyActive(ol_uid,activeLayers),isSel=!1,sind=0;sind<data.selected.length;sind++)if(data.selected[sind]===App4Sea.OpenLayers.layers[lind].id){isSel=!0;break}isSel||-1===activeIndex||App4Sea.OpenLayers.Map.removeLayer(App4Sea.OpenLayers.layers[lind].vector)}"Description"!==node.text&&"Author"!==node.text||node.state.selected&&showMetadata(node.text,node.id,node.data);for(var ind=0;ind<data.selected.length;ind++){var nod=$(this).jstree("get_node",data.selected[ind]),index=App4Sea.Utils.alreadyLayer(nod.id,App4Sea.OpenLayers.layers);if(-1===index){var path=nod.a_attr.path,heat=nod.a_attr.heat;if(path&&""!==path)if(console.log("Layer being added: "+nod.id+": "+nod.text),heat&&!0===heat){if(-1===index){var vect=App4Sea.Utils.heatMap(path,nod.id,nod.text);App4Sea.OpenLayers.layers.push({id:nod.id,vector:vect}),console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(vect)}}else if(path.length>3){var ext=path.substr(path.length-3,3);if("1cd"===ext){if(-1===index){var vect=App4Sea.Weather.loadWeather(path,nod.id);App4Sea.OpenLayers.layers.push({id:nod.id,vector:vect}),console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(vect)}}else if("6e4"===ext){if(-1===index)var vect=App4Sea.Weather.loadCityWeather(path,nod.id)}else if("gif"===ext||"cgi"===ext||"wms"===ext||"png"===ext||"jpg"===ext){if(-1===index){var vect=App4Sea.Utils.loadImage(!0,path,nod.id,nod.text,nod.a_attr.layers,nod.a_attr.width,nod.a_attr.height,nod.a_attr.start);App4Sea.OpenLayers.layers.push({id:nod.id,vector:vect}),console.log("Cached layers now are "+App4Sea.OpenLayers.layers.length),App4Sea.OpenLayers.Map.addLayer(vect)}}else-1===index&&App4Sea.KML.loadKmlKmz(path,nod.id,nod.text)}}else{var activeLayers=App4Sea.OpenLayers.Map.getLayers(),ol_uid=App4Sea.OpenLayers.layers[index].vector.ol_uid,activeIndex;-1===(activeIndex=App4Sea.Utils.alreadyActive(ol_uid,activeLayers))&&(console.log("Layer being activated from cache: "+nod.id+": "+nod.text),App4Sea.OpenLayers.Map.addLayer(App4Sea.OpenLayers.layers[index].vector))}}}})},my.Checkbox=function(layerid,on){on?$.jstree.reference("#TreeMenu").check_node(layerid):$.jstree.reference("#TreeMenu").uncheck_node(layerid)},my}(App4Sea.TreeMenu||{});