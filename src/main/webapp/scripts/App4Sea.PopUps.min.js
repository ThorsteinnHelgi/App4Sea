App4Sea=App4Sea||{},App4Sea.PopUps=function(){"use strict";var my={},popupContent,popupContainer,popupCloser;function setNorwegianOSRInfo(features){var beredskap={name:"",region:"",region2:"",region3:"",region4:"",address:"",link:""};beredskap.name=features[0].get("navn"),beredskap.address=features[0].get("gateadresse"),beredskap.region=features[0].get("fylke"),beredskap.region2=features[0].get("kyv_region"),beredskap.region3=features[0].get("kommune"),beredskap.region4=features[0].get("lua"),beredskap.link=features[0].get("lenke_faktaark");var template='<div style="margin:2px;">\n                <h3>{{name}}</h3>\n                <p>{{address}}</p>\n                <p>{{region}}</p>\n                <p>{{region2}}</p>\n                <p>{{region3}}</p>\n                <p>{{region4}}</p>\n                <p>{{{link}}}</p>\n            </div>',description;return Mustache.parse(template),Mustache.to_html(template,beredskap)}function setShipPassageInfo(features){var shipinfo={name:"",callsign:"",type:"",cargotype:"",flag:""};shipinfo.name=features[0].get("Name"),shipinfo.callsign=features[0].get("Call_Sign"),shipinfo.type=features[0].get("Type"),shipinfo.cargotype=features[0].get("Cargo_Type"),shipinfo.flag=features[0].get("Flag");var template='<div style="margin:2px;">\n                <h3>{{name}}</h3>\n                <p>{{callsign}}</p>\n                <p>{{type}}</p>\n                <p>{{cargotype}}</p>\n                <p>{{flag}}</p>\n            </div>',description;return Mustache.parse(template),Mustache.to_html(template,shipinfo)}function getHeight(doc){var pageHeight=0;function findHighestNode(nodesList){for(var i=nodesList.length-1;i>=0;i--){if(nodesList[i].scrollHeight&&nodesList[i].clientHeight&&nodesList[i].offsetHeight){var elHeight=Math.max(nodesList[i].scrollHeight,nodesList[i].clientHeight,nodesList[i].offsetHeight);pageHeight=Math.max(elHeight,pageHeight)}nodesList[i].childNodes.length&&findHighestNode(nodesList[i].childNodes)}}return findHighestNode(doc.documentElement.childNodes),console.log("Page height is",pageHeight),pageHeight}function FindTemplate(node){var template;if("styleUrl"===node.nodeName)for(var i=App4Sea.OpenLayers.styleMaps.length-1;i>=0;i--){var styleUrlCore=App4Sea.Utils.parseURL(node.innerHTML);if("#"+App4Sea.OpenLayers.styleMaps[i].id===styleUrlCore.hash&&(template=FindTemplate(App4Sea.OpenLayers.styleMaps[i].node)))return template}if("BalloonStyle"===node.nodeName&&node.children.length>0)return template=node.children[0].innerHTML;for(var cind=0;cind<node.children.length;cind++){var child;if(template=FindTemplate(node.children[cind]))return template}return template}return my.overlayLayerPopUp,my.Init=function(){popupContent=document.getElementById("popup-content"),popupContainer=document.getElementById("popup"),popupCloser=document.getElementById("popup-closer"),my.overlayLayerPopUp=App4Sea.OpenLayers.initOverlay(popupContainer,popupCloser),App4Sea.OpenLayers.Map.addOverlay(my.overlayLayerPopUp)},my.SingleClick=function(evt){console.log("my.SingleClick");var coordinate=evt.coordinate,features=[];if(App4Sea.OpenLayers.Map.forEachFeatureAtPixel(evt.pixel,function(feature){features.push(feature)}),features.length>0){var description=features[0].get("description");features[0].get("navn")?description=setNorwegianOSRInfo(features):features[0].get("Id")&&(description=setShipPassageInfo(features)),description||(description=features[0].get("name"));for(var styleUrl=features[0].get("styleUrl"),template,i=App4Sea.OpenLayers.styleMaps.length-1;i>=0;i--){var styleUrlCore=App4Sea.Utils.parseURL(styleUrl);if("#"+App4Sea.OpenLayers.styleMaps[i].id===styleUrlCore.hash&&(template=FindTemplate(App4Sea.OpenLayers.styleMaps[i].node)))break}if(template){var realTemplate=template.substr(9),moreRealTemplate=(realTemplate=realTemplate.substr(0,realTemplate.length-3)).replaceAll(/\$\[(.+?)\//,"{{");moreRealTemplate=(moreRealTemplate=(moreRealTemplate=moreRealTemplate.replaceAll("]","}}")).replaceAll("{{http","{{{http")).replaceAll(/{{{(.+?)}}/,/{{{(.+?)}}}/),description=App4Sea.PopUps.PopulateTemplate(moreRealTemplate,features[0])}popupContent.innerHTML=description,my.overlayLayerPopUp.setPosition(coordinate)}else my.overlayLayerPopUp.setPosition(void 0),popupCloser.blur()},my.initToolTip=function(){var map=App4Sea.OpenLayers.Map,displayFeatureInfo=function(pixel){$("#ToolTipInfo").css({left:pixel[0]+"px",top:pixel[1]-15+"px"});var feature=map.forEachFeatureAtPixel(pixel,function(feature,layer){return feature});if(feature){var name=feature.get("name"),inf;if(name||(name=feature.get("navn")),name)$("#ToolTipInfo").tooltip("hide").attr("data-original-title",name).tooltip("show");else $("#ToolTipInfo").tooltip("hide")}else $("#ToolTipInfo").tooltip("hide")};map.on("pointermove",function(evt){evt.dragging?$("#ToolTipInfo").tooltip("hide"):displayFeatureInfo(map.getEventPixel(evt.originalEvent))}),$(map.getViewport()).on("mousemove",function(evt){displayFeatureInfo(map.getEventPixel(evt.originalEvent))})},my.PopulateTemplate=function(template,feature){var retVal;return Mustache.parse(template),Mustache.to_html(template,feature.values_)},my}(App4Sea.PopUps||{});